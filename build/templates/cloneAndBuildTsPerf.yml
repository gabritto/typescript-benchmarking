steps:
  # The existence of this AzDo project/repository is not secret.
  - bash: |
      set -eo pipefail
      rm -rf $(Pipeline.Workspace)/internal
      git clone --depth=1 https://mseng:${PAT}@mseng.visualstudio.com/Typescript/_git/Typescript $(Pipeline.Workspace)/internal
    env:
      PAT: $(tslab1-mseng-PAT)
    displayName: Clone internal repo
    retryCountOnTaskFailure: 3

  - bash: |
      set -eo pipefail
      cd $(Pipeline.Workspace)/internal/scripts/perf
      npx yarn install --frozen-lockfile --prefer-offline
    displayName: Install ts-perf deps
    retryCountOnTaskFailure: 3

  - bash: |
      set -eo pipefail
      cd $(Pipeline.Workspace)/internal/scripts/perf
      npx yarn gulp build
      echo "##vso[task.setvariable variable=TSPERF_EXE]$(Pipeline.Workspace)/internal/scripts/perf/bin/ts-perf"
    displayName: Build ts-perf
