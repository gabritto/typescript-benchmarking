steps:
  - checkout: self
    path: typescript-benchmarking
    fetchTags: false
    fetchDepth: 1
    clean: true
    retryCountOnTaskFailure: 3

  - bash: |
      set -eo pipefail
      cd $(Pipeline.Workspace)/typescript-benchmarking
      pnpm install
    displayName: Install typescript-benchmarking
    retryCountOnTaskFailure: 3

  - bash: |
      set -eo pipefail
      cd $(Pipeline.Workspace)/typescript-benchmarking
      pnpm build
    displayName: Build typescript-benchmarking

  - bash: |
      echo "##vso[task.setvariable variable=BENCH_SCRIPTS]$(Pipeline.Workspace)/typescript-benchmarking/scripts"
      # TODO(jakebailey): we can resolve this directly from the scripts dir now
      echo "##vso[task.setvariable variable=TSPERF_EXE]$(Pipeline.Workspace)/typescript-benchmarking/ts-perf/bin/ts-perf"
    displayName: Set typescript-benchmarking variables
